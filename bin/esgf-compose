#!/usr/bin/env bash

#####
# This script runs docker-compose using a Compose file generated by esgf-setup
#####

set -e

BIN_DIR="$(realpath "$(dirname "$BASH_SOURCE")")"
REPO_DIR="$(dirname "$BIN_DIR")"

# In order for interactive commands like "run esgf-publisher bash" to work,
# we can't use stdin for the compose file
# So write a tempfile
ESGF_COMPOSE_FILE="$(mktemp)"
"$BIN_DIR/esgf-setup" compose-file > "$ESGF_COMPOSE_FILE"
# By default, specifying the compose file uses the directory containing that
# file as the project directory. So we also need to correct that.
exec docker-compose -f "$ESGF_COMPOSE_FILE" --project-directory "$REPO_DIR" "$@"
