
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Docker Swarm Setup on MacOSX &#8212; ESGF-Docker Documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Docker Swarm Setup on Linux" href="docker_swarm_setup_on_linux.html" />
    <link rel="prev" title="Architecture and Development Guidelines" href="architecture_and_development_guidelines.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="docker_swarm_setup_on_linux.html" title="Docker Swarm Setup on Linux"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="architecture_and_development_guidelines.html" title="Architecture and Development Guidelines"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ESGF-Docker Documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="docker-swarm-setup-on-macosx">
<span id="id1"></span><h1>Docker Swarm Setup on MacOSX<a class="headerlink" href="#docker-swarm-setup-on-macosx" title="Permalink to this headline">¶</a></h1>
<div class="section" id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>This page instructs on how to setup a Docker Swarm on a single MacOSX
system. This Swarm can be effectively used as a test environment for
deploying ESGF software stack on a multiple-host cluster.</p>
<p>Note that all the following steps except the last can be accomplished by executing the script <em>scripts/setup_swarm_macosx.sh</em>.</p>
</div>
<div class="section" id="execution">
<h2>Execution<a class="headerlink" href="#execution" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Use Docker to create a cluster of N Virtual Machines, for example N=6:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">machine</span> <span class="n">create</span> <span class="o">--</span><span class="n">driver</span> <span class="n">virtualbox</span> <span class="n">node1</span>
<span class="n">docker</span><span class="o">-</span><span class="n">machine</span> <span class="n">create</span> <span class="o">--</span><span class="n">driver</span> <span class="n">virtualbox</span> <span class="n">node2</span>
<span class="n">docker</span><span class="o">-</span><span class="n">machine</span> <span class="n">create</span> <span class="o">--</span><span class="n">driver</span> <span class="n">virtualbox</span> <span class="n">node3</span>
<span class="n">docker</span><span class="o">-</span><span class="n">machine</span> <span class="n">create</span> <span class="o">--</span><span class="n">driver</span> <span class="n">virtualbox</span> <span class="n">node4</span>
<span class="n">docker</span><span class="o">-</span><span class="n">machine</span> <span class="n">create</span> <span class="o">--</span><span class="n">driver</span> <span class="n">virtualbox</span> <span class="n">node5</span>
<span class="n">docker</span><span class="o">-</span><span class="n">machine</span> <span class="n">create</span> <span class="o">--</span><span class="n">driver</span> <span class="n">virtualbox</span> <span class="n">node6</span>
</pre></div>
</div>
</li>
<li><p class="first">List the VMs to identify their IP addresses:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">machine</span> <span class="n">ls</span>
</pre></div>
</div>
</li>
<li><p class="first">Select one of the nodes to be the Swarm leader, “connect” to it, and
initialize the Swarm, using its IP address (in what follows, we use
$IP_MANAGER_ADDRESS=192.168.99.100). Save the output of the last
command, since it will be needed on the other nodes to join the swarm.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>eval $(docker-machine env node1)
docker swarm init --advertise-addr 192.168.99.100
</pre></div>
</div>
</li>
<li><p class="first">Make the other VMs join the swarm, one at a time. For example, on node2 (using the worker token from the previous command):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>eval $(docker-machine env node2)
docker swarm join --token \
   SWMTKN-1-0di7dn7qutbknirl9zrx2dodxwz7mj7ax708cf6fjtslorsypb-3fp4nrsg79ufrcxna93yk4l8o \
   192.168.99.100:2377
</pre></div>
</div>
<p>Replace the last command with the output from the “docker swarm init…”
command issued on the Swarm manager. Repeat this process on all worker nodes
in the Swarm. Finally, list all nodes in the Swarm:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">node</span> <span class="n">ls</span>
</pre></div>
</div>
</li>
<li><p class="first">Back on the Swarm manager, assign metadata tags to all nodes in the
Swarm to define where the different ESGF container/services will be
placed. For example, on a 6-nodes Swarm:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>eval $(docker-machine env node1)
docker node update --label-add esgf_front_node=true node1
docker node update --label-add esgf_db_node=true node2
docker node update --label-add esgf_index_node=true node3
docker node update --label-add esgf_idp_node=true node4
docker node update --label-add esgf_data_node=true node5
docker node update --label-add esgf_solr_node=true node6
</pre></div>
</div>
</li>
<li><p class="first">Associate the IP address of the Swarm manager node to the hostname
you intend to use to access the ESGF services. For example if $ESGF_HOSTNAME=my-node.esgf.org:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vi</span> <span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hosts</span>
<span class="mf">192.168</span><span class="o">.</span><span class="mf">99.100</span> <span class="n">my</span><span class="o">-</span><span class="n">node</span><span class="o">.</span><span class="n">esgf</span><span class="o">.</span><span class="n">org</span>
</pre></div>
</div>
<p>Note that because of the Docker Swarm routing mesh capability, the IP
address above can be that of any node in the Swarm, and that URLs
starting with http(s)://my-node.esgf.org/… can be used to access any
of the ESGF services in the stack, no matter on which node they are deployed.</p>
</li>
</ul>
</div>
<div class="section" id="developer-corner">
<h2>Developer corner<a class="headerlink" href="#developer-corner" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Required tools for image buidlers and developers<ul>
<li>gnu-tar</li>
<li>gnu-getopt</li>
</ul>
</li>
</ul>
<p>these tools replace the embedded macosx tools, respectively tar and getopt that
don’t support features used in some scripts. To easly install these tools,</p>
<ol class="arabic">
<li><p class="first">install <a class="reference external" href="https://brew.sh">homebrew</a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">ruby</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">then install the required tools:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">brew</span> <span class="n">install</span> <span class="n">gnu</span><span class="o">-</span><span class="n">tar</span>
<span class="n">brew</span> <span class="n">install</span> <span class="n">gnu</span><span class="o">-</span><span class="n">getopt</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Docker Swarm Setup on MacOSX</a><ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#execution">Execution</a></li>
<li><a class="reference internal" href="#developer-corner">Developer corner</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="architecture_and_development_guidelines.html"
                        title="previous chapter">Architecture and Development Guidelines</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="docker_swarm_setup_on_linux.html"
                        title="next chapter">Docker Swarm Setup on Linux</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/docker_swarm_setup_on_macosx.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="docker_swarm_setup_on_linux.html" title="Docker Swarm Setup on Linux"
             >next</a> |</li>
        <li class="right" >
          <a href="architecture_and_development_guidelines.html" title="Architecture and Development Guidelines"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ESGF-Docker Documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, ESGF.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.3.
    </div>
  </body>
</html>