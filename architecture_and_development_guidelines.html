<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Architecture and Development Guidelines &#8212; ESGF-Docker Documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Docker Swam Setup on MacOSX" href="docker_swarm_setup_on_macosx.html" />
    <link rel="prev" title="Data Publishing" href="data_publishing.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="docker_swarm_setup_on_macosx.html" title="Docker Swam Setup on MacOSX"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="data_publishing.html" title="Data Publishing"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ESGF-Docker Documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="architecture-and-development-guidelines">
<h1>Architecture and Development Guidelines<a class="headerlink" href="#architecture-and-development-guidelines" title="Permalink to this headline">¶</a></h1>
<p>The design and development of the ESGF/Docker services should conform
(whenever possible) to the following guidelines.</p>
<div class="section" id="image-hierarchy">
<h2>Image Hierarchy<a class="headerlink" href="#image-hierarchy" title="Permalink to this headline">¶</a></h2>
<p>ESGF images are built in a hierarchy structure where common libraries,
tools and functionality are factored in a parent image, from which more
specific images are derived. This design has several benefits:</p>
<ul class="simple">
<li>All images run the same version of the core OS, libraries and engines such
as Centos, Java, Python, SSL, Tomcat, etc.</li>
<li>It&#8217;s easy to propagate updates of any of these components to all images.</li>
<li>Common building instructions are not repeated, in different form, in different Dockerfiles.</li>
</ul>
<p>The current version of the ESGF image hierarchy is shown in the figure below.</p>
</div>
<div class="section" id="image-content">
<h2>Image Content<a class="headerlink" href="#image-content" title="Permalink to this headline">¶</a></h2>
<p>For maximum flexibility, and conforming to the &#8220;micro-services&#8221;
architecture, each ESGF image should contain only one service,
interacting with the other ESGF services through publicly exposed
endpoints. In some cases though a set of services must be co-located as
they cannot function without each other, in which case they should be
built into the same image (see for example the esgf-data-node image).</p>
</div>
<div class="section" id="image-versioning">
<h2>Image Versioning<a class="headerlink" href="#image-versioning" title="Permalink to this headline">¶</a></h2>
<p><em>Insert content from Sebastien G. proposal.</em></p>
</div>
<div class="section" id="directory-structure">
<h2>Directory Structure<a class="headerlink" href="#directory-structure" title="Permalink to this headline">¶</a></h2>
<p>In order to promote conformity and easy of development, each ESGF/Docker
image should be built from a directory that conforms to the following
directory structure:</p>
<ul class="simple">
<li><em>Dockerfile</em> : Docker build file</li>
<li><em>conf/</em> : image configuration files (for supervisor or the application)</li>
<li><em>scripts/</em> : scripts necessary to perform initialization of other
application tasks (for example, create a Solr shard)</li>
</ul>
<p>Deployment files that span several services, such as docker-compose and
docker-stack files, are (for now) stored in the top-level directory of
this repository.</p>
</div>
<div class="section" id="supervisor">
<h2>Supervisor<a class="headerlink" href="#supervisor" title="Permalink to this headline">¶</a></h2>
<p>ESGF images should use the Python program &#8220;Supervisor&#8221; to start and
monitor services inside a Docker container. Benefits of using Supervisor
include:</p>
<ul class="simple">
<li>Common instructions for starting/stopping/restarting each
service from inside each container.</li>
<li>Ability to add services to the
startup pool by simply dropping configuration files in a standard location.</li>
<li>Ability to start/stop/restart entire group of services (for example, all Solr shards at once).</li>
<li>Ability to start services as non-privileged users such as &#8220;tomcat&#8221;, &#8220;apache&#8221;, etc.</li>
</ul>
</div>
<div class="section" id="container-initialization">
<h2>Container Initialization<a class="headerlink" href="#container-initialization" title="Permalink to this headline">¶</a></h2>
<p>In some cases, it is necessary to execute some initialization tasks when
a container first start, or when it is re-started. In this case, the
container services should be started through a docker-entrypoint.sh
script which:</p>
<ul class="simple">
<li>First performs all required initialization.</li>
<li>Then starts Supervisor in non-daemon mode (to keep the container running).</li>
</ul>
</div>
<div class="section" id="site-specific-configuration">
<h2>Site-Specific Configuration<a class="headerlink" href="#site-specific-configuration" title="Permalink to this headline">¶</a></h2>
<p>ESGF/Docker images must not contain any site-specific files or
configuration, such as SSL certificates, hostnames, passwords etc. At
this time, all site-specific configuration is stored in a directory tree
rooted at $ESGF_CONFIG/, which is cross-mounted as a shared volume on
on all containers. In the future, the site-specific configuration might
be &#8220;pushed&#8221; to the containers via other means.</p>
</div>
<div class="section" id="persistent-data">
<h2>Persistent Data<a class="headerlink" href="#persistent-data" title="Permalink to this headline">¶</a></h2>
<p>ESGF services access data that must be persisted across container
restarts or upgrades. Examples of these data include:</p>
<ul class="simple">
<li>Postgres database content</li>
<li>TDS catalogs</li>
<li>Solr indexes</li>
<li>CoG site media</li>
</ul>
<p>These data must either be located on shared host directories that are
cross-mounted to all containers, or inside named data volumes (which are
managed by Docker outside of the container lifecycle). They can not be
located inside the Docker containers as they would be lost during
upgrades.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Architecture and Development Guidelines</a><ul>
<li><a class="reference internal" href="#image-hierarchy">Image Hierarchy</a></li>
<li><a class="reference internal" href="#image-content">Image Content</a></li>
<li><a class="reference internal" href="#image-versioning">Image Versioning</a></li>
<li><a class="reference internal" href="#directory-structure">Directory Structure</a></li>
<li><a class="reference internal" href="#supervisor">Supervisor</a></li>
<li><a class="reference internal" href="#container-initialization">Container Initialization</a></li>
<li><a class="reference internal" href="#site-specific-configuration">Site-Specific Configuration</a></li>
<li><a class="reference internal" href="#persistent-data">Persistent Data</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="data_publishing.html"
                        title="previous chapter">Data Publishing</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="docker_swarm_setup_on_macosx.html"
                        title="next chapter">Docker Swam Setup on MacOSX</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/architecture_and_development_guidelines.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="docker_swarm_setup_on_macosx.html" title="Docker Swam Setup on MacOSX"
             >next</a> |</li>
        <li class="right" >
          <a href="data_publishing.html" title="Data Publishing"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ESGF-Docker Documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, ESGF.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.6.
    </div>
  </body>
</html>