<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Multiple Hosts Deployment &mdash; ESGF-Docker Documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="ESGF-Docker Documentation" href="index.html" />
    <link rel="next" title="Data Publishing" href="data_publishing.html" />
    <link rel="prev" title="Single Host Deployment" href="single_host_deployment.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="data_publishing.html" title="Data Publishing"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="single_host_deployment.html" title="Single Host Deployment"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">ESGF-Docker Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="multiple-hosts-deployment">
<h1>Multiple Hosts Deployment<a class="headerlink" href="#multiple-hosts-deployment" title="Permalink to this headline">¶</a></h1>
<div class="section" id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>These instructions explain how to deploy the ESGF software stack as a
set of interacting Docker containers deployed on a cluster of Swarm
nodes. Which ESGF services/containers are deployed onto which nodes is
determined by placement constraints defined by node metadata tags. A
single physical node can host services of one or more types, if the
appropriate metadata tags are set for that node.</p>
<p><em>Tested with $ESGF_VERSION=1.2</em>.</p>
</div>
<div class="section" id="pre-requisites">
<h2>Pre-Requisites<a class="headerlink" href="#pre-requisites" title="Permalink to this headline">¶</a></h2>
<p>A Docker Swarm composed of 1 or more nodes. See specific instructions on
how to set this up on <a class="reference internal" href="docker_swarm_setup_on_macosx.html#docker-swarm-setup-on-macosx"><em>a single MacOSX laptop</em></a>, on the Amazon Cloud, or an
internal Linux cluster.</p>
</div>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>Follow the same setup steps as for the <a class="reference internal" href="single_host_deployment.html#single-host-deployment"><em>Single Host Deployment</em></a>, namely:</p>
<ul class="simple">
<li>Checkout the source code from this GitHub repository, on some
location on the Swarm manager node.</li>
<li>Define the environmental variables $ESGF_HOSTNAME, $ESGF_CONFIG,
$ESGF_VERSION and $ESGF_DATA_DIR.</li>
<li>Initialize the ESGF node configuration: ./esgf_node_init.sh</li>
</ul>
<p>Note that in this particular architecture, even if the ESGF services are
deployed across multiple hosts, they all share the same SSL certificate
(cross-mounted from a shared volume), and they are all reachable at the
hostname $ESGF_HOSTNAME: this is because the Docker Swarm routing mesh
always directs client requests sent to $ESGF_HOSTNAME to the proper
container(s) where the specific services are deployed.</p>
</div>
<div class="section" id="execution">
<h2>Execution<a class="headerlink" href="#execution" title="Permalink to this headline">¶</a></h2>
<ul>
<li><p class="first">Assign metadata tags to the Swarm nodes to define where the specific
ESGF services will be deployed. For example, on a Swarm cluster of 3
nodes, the following tags could be assigned:</p>
<div class="highlight-python"><div class="highlight"><pre>docker node update --label-add esgf_front_node=true node1
docker node update --label-add esgf_db_node=true node1
docker node update --label-add esgf_idp_node=true node1
docker node update --label-add esgf_index_node=true node2
docker node update --label-add esgf_solr_node=true node2
docker node update --label-add esgf_data_node=true node3
</pre></div>
</div>
</li>
<li><p class="first">From the source code directory on the Swarm manager node, issue the
following command to deploy the stack of ESGF services, then wait for
the services to be ready (which the first time might take several
minutes, since several large images need to be downloaded to the
various nodes in the Swarm):</p>
<div class="highlight-python"><div class="highlight"><pre>docker stack deploy -c docker-stack.yml esgf-stack
docker service ls
</pre></div>
</div>
</li>
<li><p class="first">When all services are deployed, test the following URLs, replacing
&#8220;my-node.esgf.org&#8221; with your value of $ESGF_HOSTNAME:</p>
<ul class="simple">
<li>Docker visualizer tool: <a class="reference external" href="http://my-node.esgf.org:8080/">http://my-node.esgf.org:8080/</a></li>
<li>Solr admin interface: <a class="reference external" href="https://my-node.esgf.org/solr/#/">https://my-node.esgf.org/solr/#/</a></li>
<li>ESGF search API: <a class="reference external" href="http://my-node.esgf.org/esg-search/search">http://my-node.esgf.org/esg-search/search</a></li>
<li>ESGF IdP: <a class="reference external" href="https://my-node.esgf.org/esgf-idp/">https://my-node.esgf.org/esgf-idp/</a></li>
<li>CoG home project: <a class="reference external" href="https://my-node.esgf.org/projects/testproject/">https://my-node.esgf.org/projects/testproject/</a>. The first time, login with:<ul>
<li>openid=https://my-node.esgf.org/esgf-idp/openid/rootAdmin and</li>
<li>password=changeit</li>
</ul>
</li>
<li>TDS: <a class="reference external" href="https://my-node.esgf.org/thredds">https://my-node.esgf.org/thredds</a></li>
<li>ORP: <a class="reference external" href="https://my-node.esgf.org/esg-orp/">https://my-node.esgf.org/esg-orp/</a></li>
<li>SLCS: <a class="reference external" href="https://my-node.esgf.org/slcs/admin/">https://my-node.esgf.org/slcs/admin/</a></li>
</ul>
</li>
<li><p class="first">Clean up: remove the full ESGF stack from the Swarm:</p>
<div class="highlight-python"><div class="highlight"><pre>docker stack rm esgf-stack
</pre></div>
</div>
</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Multiple Hosts Deployment</a><ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#pre-requisites">Pre-Requisites</a></li>
<li><a class="reference internal" href="#setup">Setup</a></li>
<li><a class="reference internal" href="#execution">Execution</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="single_host_deployment.html"
                        title="previous chapter">Single Host Deployment</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="data_publishing.html"
                        title="next chapter">Data Publishing</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/multiple_hosts_deployment.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="data_publishing.html" title="Data Publishing"
             >next</a> |</li>
        <li class="right" >
          <a href="single_host_deployment.html" title="Single Host Deployment"
             >previous</a> |</li>
        <li><a href="index.html">ESGF-Docker Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2017, ESGF.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3b2.
    </div>
  </body>
</html>